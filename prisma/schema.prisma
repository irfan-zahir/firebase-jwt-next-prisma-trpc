// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider     = "mysql"
    url          = env("DATABASE_URL")
    relationMode = "prisma"
}

enum UserRole {
    user
    admin
}

model UserAccount {
    id        Int      @id @default(autoincrement())
    uid       String   @unique
    createdAt DateTime @default(now())

    email    String @unique
    username String @unique

    role UserRole

    posts      Post[]
    likedPosts PostLike[]

    followers UserFollow[] @relation("following")
    following UserFollow[] @relation("follower")
}

model Post {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now())

    user    UserAccount @relation(fields: [ownerId], references: [id])
    ownerId Int

    title String
    slug  String @unique

    likes PostLike[]

    @@index([ownerId])
}

model PostLike {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now())

    user   UserAccount @relation(fields: [userId], references: [id])
    userId Int

    post   Post @relation(fields: [postId], references: [id])
    postId Int

    @@index([userId])
    @@index([postId])
}

model UserFollow {
    follower   UserAccount @relation("follower", fields: [followerId], references: [id])
    followerId Int

    following   UserAccount @relation("following", fields: [followingId], references: [id])
    followingId Int

    @@id([followerId, followingId])
    @@index([followerId])
    @@index([followingId])
}
